# roles/mongodb/tasks/main.yml
---
- name: Install MongoDB repository for Amazon Linux 2
  yum:
    name: mongodb
    baseurl: "https://repo.mongodb.org/yum/amazon/2/mongodb-org/6.0/x86_64/"
    enabled: yes
    gpgcheck: yes
    gpgkey: "https://www.mongodb.org/static/pgp/server-6.0.asc"

- name: Install MongoDB packages
  yum:
    name:
      - mongodb-org
    state: present

- name: Ensure MongoDB is started and enabled
  service:
    name: mongod
    state: started
    enabled: yes

- name: Deploy custom MongoDB config
  template:
    src: mongod.conf.j2
    dest: /etc/mongod.conf
  notify: Restart MongoDB

